<!DOCTYPE html>
<html>
<head>
    <title>Quick Voice Test</title>
    <style>
        body { 
            font-family: Arial; 
            padding: 20px; 
            background: #1a1a1a; 
            color: white; 
        }
        button { 
            padding: 10px 20px; 
            margin: 10px; 
            background: #0066ff; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
        }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
            background: #2c2c2c; 
        }
    </style>
</head>
<body>
    <h1>Quick Voice Test</h1>
    
    <h2>1. Test Microphone</h2>
    <button onclick="testMic()">Test Microphone</button>
    <div id="mic-status" class="status"></div>
    
    <h2>2. Test Speech</h2>
    <button onclick="testSpeech()">Test Speech Synthesis</button>
    <div id="speech-status" class="status"></div>
    
    <h2>3. Test Chat API</h2>
    <button onclick="testChat()">Test Chat API</button>
    <div id="chat-status" class="status"></div>

    <script>
        async function testMic() {
            const status = document.getElementById('mic-status');
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                status.innerHTML = '✅ Microphone works! You can speak now.';
                
                // Test browser speech recognition
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (SpeechRecognition) {
                    const recognition = new SpeechRecognition();
                    recognition.onresult = (event) => {
                        status.innerHTML += '<br>You said: ' + event.results[0][0].transcript;
                    };
                    recognition.start();
                    setTimeout(() => recognition.stop(), 5000);
                    status.innerHTML += '<br>Listening for 5 seconds...';
                }
                
                // Clean up
                stream.getTracks().forEach(track => track.stop());
            } catch (error) {
                status.innerHTML = '❌ Microphone error: ' + error.message;
            }
        }
        
        function testSpeech() {
            const status = document.getElementById('speech-status');
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance('Hello! This is a test of speech synthesis.');
                speechSynthesis.speak(utterance);
                status.innerHTML = '✅ Speaking... You should hear voice now.';
            } else {
                status.innerHTML = '❌ Speech synthesis not supported';
            }
        }
        
        async function testChat() {
            const status = document.getElementById('chat-status');
            status.innerHTML = 'Testing chat API...';
            
            try {
                const response = await fetch('http://localhost:3000/api/chat', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'Hello, can you tell me about mathematics?',
                        mode: 'conversation',
                        context: []
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    status.innerHTML = '✅ Chat API works!<br>Response: ' + data.response.substring(0, 100) + '...';
                } else {
                    const errorText = await response.text();
                    status.innerHTML = '❌ Chat API error: ' + response.status + '<br>' + errorText;
                }
            } catch (error) {
                status.innerHTML = '❌ Failed to connect: ' + error.message + '<br><br>' +
                    'Try one of these:<br>' +
                    '1. Restart the Next.js server to apply CORS changes<br>' +
                    '2. Open this file through http://localhost:8080/quick-voice-test.html<br>' +
                    '3. Go directly to the app at http://localhost:3000';
            }
        }
    </script>
</body>
</html>