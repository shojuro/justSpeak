<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JustSpeak - Complete User Experience Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #0a0a0a;
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0a0a;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loader {
            width: 60px;
            height: 60px;
            border: 3px solid #1a1a1a;
            border-top-color: #ff6b6b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Header */
        .header {
            background: #0f0f0f;
            border-bottom: 2px solid #ff6b6b;
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff6b6b;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Screens */
        .screen {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Welcome Screen */
        .welcome-screen {
            text-align: center;
            padding: 4rem 2rem;
        }
        
        .welcome-screen h1 {
            font-size: 3rem;
            color: #ff6b6b;
            margin-bottom: 1rem;
        }
        
        .welcome-screen p {
            font-size: 1.2rem;
            color: #ccc;
            margin-bottom: 3rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .cta-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        /* Buttons */
        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: #ff6b6b;
            color: white;
        }
        
        .btn-primary:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #1a1a1a;
            color: #ff6b6b;
            border: 2px solid #ff6b6b;
        }
        
        .btn-secondary:hover {
            background: #ff6b6b;
            color: white;
        }
        
        .btn-ghost {
            background: transparent;
            color: #ff6b6b;
            border: 1px solid #333;
        }
        
        .btn-ghost:hover {
            border-color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }
        
        /* Auth Forms */
        .auth-container {
            max-width: 400px;
            margin: 4rem auto;
            padding: 2rem;
            background: #0f0f0f;
            border-radius: 12px;
            border: 1px solid #1a1a1a;
        }
        
        .auth-container h2 {
            color: #ff6b6b;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #ff6b6b;
            font-size: 0.875rem;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 6px;
            color: white;
            font-size: 1rem;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #ff6b6b;
        }
        
        .error-message {
            color: #ff4444;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        
        .success-message {
            color: #4CAF50;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        
        /* Onboarding */
        .onboarding-container {
            max-width: 600px;
            margin: 2rem auto;
        }
        
        .progress-bar {
            height: 4px;
            background: #1a1a1a;
            border-radius: 2px;
            margin-bottom: 3rem;
            overflow: hidden;
        }
        
        .progress-bar-fill {
            height: 100%;
            background: #ff6b6b;
            transition: width 0.3s ease;
        }
        
        .onboarding-step {
            display: none;
            text-align: center;
        }
        
        .onboarding-step.active {
            display: block;
        }
        
        .onboarding-step h2 {
            color: #ff6b6b;
            margin-bottom: 1rem;
        }
        
        .onboarding-step p {
            color: #ccc;
            margin-bottom: 2rem;
        }
        
        .option-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .option-card {
            padding: 1.5rem;
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .option-card:hover {
            border-color: #ff6b6b;
            transform: translateY(-2px);
        }
        
        .option-card.selected {
            border-color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }
        
        /* Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .dashboard-card {
            background: #0f0f0f;
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid #1a1a1a;
        }
        
        .dashboard-card h3 {
            color: #ff6b6b;
            margin-bottom: 1rem;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: #888;
            font-size: 0.875rem;
        }
        
        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        /* Conversation Screen */
        .conversation-container {
            height: calc(100vh - 100px);
            display: flex;
            flex-direction: column;
            max-width: 900px;
            margin: 0 auto;
        }
        
        .conversation-header {
            background: #0f0f0f;
            padding: 1rem;
            border-bottom: 1px solid #1a1a1a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .timer {
            font-size: 1.2rem;
            color: #ff6b6b;
            font-weight: bold;
        }
        
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            background: #0a0a0a;
        }
        
        .message {
            margin-bottom: 1.5rem;
            animation: messageSlide 0.3s ease-out;
        }
        
        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message.user {
            text-align: right;
        }
        
        .message.assistant {
            text-align: left;
        }
        
        .message-bubble {
            display: inline-block;
            padding: 1rem 1.5rem;
            border-radius: 18px;
            max-width: 70%;
            word-wrap: break-word;
        }
        
        .message.user .message-bubble {
            background: #ff6b6b;
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        .message.assistant .message-bubble {
            background: #1a1a1a;
            color: white;
            border-bottom-left-radius: 4px;
        }
        
        .message-role {
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 0.25rem;
        }
        
        .typing-indicator {
            display: inline-block;
            padding: 1rem;
        }
        
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #ff6b6b;
            border-radius: 50%;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }
        
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }
        
        /* Conversation Controls */
        .conversation-controls {
            padding: 1.5rem;
            background: #0f0f0f;
            border-top: 1px solid #1a1a1a;
        }
        
        .mode-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 1rem;
        }
        
        .mode-toggle-container {
            background: #1a1a1a;
            padding: 0.25rem;
            border-radius: 25px;
            display: flex;
        }
        
        .mode-toggle button {
            padding: 0.5rem 1.5rem;
            border: none;
            background: transparent;
            color: #888;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .mode-toggle button.active {
            background: #ff6b6b;
            color: white;
        }
        
        .input-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .input-controls input {
            flex: 1;
            padding: 0.75rem 1rem;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 25px;
            color: white;
            font-size: 1rem;
        }
        
        .mic-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: #ff6b6b;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            position: relative;
        }
        
        .mic-button:hover {
            background: #ff5252;
            transform: scale(1.05);
        }
        
        .mic-button.recording {
            background: #ff4444;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 68, 68, 0.7);
            }
            70% {
                box-shadow: 0 0 0 20px rgba(255, 68, 68, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 68, 68, 0);
            }
        }
        
        .speaking-time {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding: 0.75rem;
            background: #1a1a1a;
            border-radius: 8px;
        }
        
        .time-stat {
            text-align: center;
        }
        
        .time-stat .label {
            font-size: 0.75rem;
            color: #888;
        }
        
        .time-stat .value {
            font-size: 1.2rem;
            color: #ff6b6b;
            font-weight: bold;
        }
        
        /* Settings Panel */
        .settings-panel {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100%;
            background: #0f0f0f;
            border-left: 1px solid #1a1a1a;
            z-index: 200;
            transition: right 0.3s ease;
            overflow-y: auto;
        }
        
        .settings-panel.open {
            right: 0;
        }
        
        .settings-header {
            padding: 1.5rem;
            border-bottom: 1px solid #1a1a1a;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .settings-content {
            padding: 1.5rem;
        }
        
        .settings-section {
            margin-bottom: 2rem;
        }
        
        .settings-section h3 {
            color: #ff6b6b;
            margin-bottom: 1rem;
        }
        
        .provider-options {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .provider-option {
            padding: 1rem;
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .provider-option:hover {
            border-color: #ff6b6b;
        }
        
        .provider-option.selected {
            border-color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }
        
        .provider-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            background: #1a1a1a;
        }
        
        .status-badge.available {
            background: #4CAF50;
            color: white;
        }
        
        .status-badge.unavailable {
            background: #f44336;
            color: white;
        }
        
        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
        }
        
        .toast {
            background: #1a1a1a;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            min-width: 300px;
            animation: slideIn 0.3s ease-out;
            border-left: 4px solid #ff6b6b;
        }
        
        .toast.error {
            border-left-color: #f44336;
        }
        
        .toast.success {
            border-left-color: #4CAF50;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .welcome-screen h1 {
                font-size: 2rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .settings-panel {
                width: 100%;
                right: -100%;
            }
            
            .message-bubble {
                max-width: 85%;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loader"></div>
        <p style="margin-top: 2rem; color: #ff6b6b;">Loading JustSpeak...</p>
    </div>

    <!-- Header -->
    <header class="header" id="header" style="display: none;">
        <div class="header-content">
            <div class="logo">JustSpeak</div>
            <div class="user-info">
                <span id="userName">Guest</span>
                <button class="btn btn-ghost" onclick="showSettings()">Settings</button>
                <button class="btn btn-ghost" onclick="logout()">Logout</button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Welcome Screen -->
        <div class="screen active" id="welcomeScreen">
            <div class="welcome-screen">
                <h1>Welcome to JustSpeak</h1>
                <p>Practice English conversation with AI-powered chat and voice recognition</p>
                <div class="cta-buttons">
                    <button class="btn btn-primary" onclick="showScreen('loginScreen')">Login</button>
                    <button class="btn btn-secondary" onclick="showScreen('signupScreen')">Sign Up</button>
                    <button class="btn btn-ghost" onclick="startGuestMode()">Try as Guest</button>
                </div>
            </div>
        </div>

        <!-- Login Screen -->
        <div class="screen" id="loginScreen">
            <div class="auth-container">
                <h2>Welcome Back</h2>
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="loginEmail" required placeholder="your@email.com">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="loginPassword" required placeholder="••••••••">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                    <div id="loginError" class="error-message" style="margin-top: 1rem; text-align: center;"></div>
                </form>
                <p style="text-align: center; margin-top: 2rem; color: #888;">
                    Don't have an account? 
                    <a href="#" onclick="showScreen('signupScreen')" style="color: #ff6b6b;">Sign up</a>
                </p>
            </div>
        </div>

        <!-- Signup Screen -->
        <div class="screen" id="signupScreen">
            <div class="auth-container">
                <h2>Create Account</h2>
                <form onsubmit="handleSignup(event)">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="signupName" required placeholder="Your Name">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="signupEmail" required placeholder="your@email.com">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="signupPassword" required placeholder="••••••••">
                    </div>
                    <div class="form-group">
                        <label>Age Group</label>
                        <select id="signupAgeGroup" required>
                            <option value="">Select age group</option>
                            <option value="elementary">Elementary (9-12)</option>
                            <option value="middle">Middle School (13-15)</option>
                            <option value="high">High School (16-18)</option>
                            <option value="adult">Adult (18+)</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Sign Up</button>
                    <div id="signupError" class="error-message" style="margin-top: 1rem; text-align: center;"></div>
                </form>
                <p style="text-align: center; margin-top: 2rem; color: #888;">
                    Already have an account? 
                    <a href="#" onclick="showScreen('loginScreen')" style="color: #ff6b6b;">Login</a>
                </p>
            </div>
        </div>

        <!-- Onboarding Screen -->
        <div class="screen" id="onboardingScreen">
            <div class="onboarding-container">
                <div class="progress-bar">
                    <div class="progress-bar-fill" id="progressBar" style="width: 25%"></div>
                </div>
                
                <!-- Step 1: Goals -->
                <div class="onboarding-step active" id="step1">
                    <h2>What are your learning goals?</h2>
                    <p>Select all that apply</p>
                    <div class="option-grid">
                        <div class="option-card" onclick="toggleGoal('conversation')">
                            <h4>💬 Daily Conversation</h4>
                            <p>Improve everyday speaking</p>
                        </div>
                        <div class="option-card" onclick="toggleGoal('business')">
                            <h4>💼 Business English</h4>
                            <p>Professional communication</p>
                        </div>
                        <div class="option-card" onclick="toggleGoal('travel')">
                            <h4>✈️ Travel English</h4>
                            <p>Navigate while traveling</p>
                        </div>
                        <div class="option-card" onclick="toggleGoal('academic')">
                            <h4>📚 Academic English</h4>
                            <p>Study and research</p>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="nextOnboardingStep()">Continue</button>
                </div>
                
                <!-- Step 2: Level -->
                <div class="onboarding-step" id="step2">
                    <h2>What's your English level?</h2>
                    <p>This helps us customize your experience</p>
                    <div class="option-grid">
                        <div class="option-card" onclick="selectLevel('beginner')">
                            <h4>🌱 Beginner</h4>
                            <p>Just starting out</p>
                        </div>
                        <div class="option-card" onclick="selectLevel('intermediate')">
                            <h4>🌿 Intermediate</h4>
                            <p>Can hold basic conversations</p>
                        </div>
                        <div class="option-card" onclick="selectLevel('advanced')">
                            <h4>🌳 Advanced</h4>
                            <p>Fluent but improving</p>
                        </div>
                    </div>
                    <div style="margin-top: 2rem;">
                        <button class="btn btn-ghost" onclick="previousOnboardingStep()">Back</button>
                        <button class="btn btn-primary" onclick="nextOnboardingStep()">Continue</button>
                    </div>
                </div>
                
                <!-- Step 3: Preferences -->
                <div class="onboarding-step" id="step3">
                    <h2>Set your preferences</h2>
                    <p>How much time can you practice daily?</p>
                    <div class="form-group" style="max-width: 300px; margin: 0 auto;">
                        <label>Daily Goal (minutes)</label>
                        <select id="dailyGoal">
                            <option value="5">5 minutes</option>
                            <option value="10">10 minutes</option>
                            <option value="15" selected>15 minutes</option>
                            <option value="30">30 minutes</option>
                            <option value="60">60 minutes</option>
                        </select>
                    </div>
                    <div style="margin-top: 2rem;">
                        <button class="btn btn-ghost" onclick="previousOnboardingStep()">Back</button>
                        <button class="btn btn-primary" onclick="completeOnboarding()">Get Started</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Screen -->
        <div class="screen" id="dashboardScreen">
            <h1 style="color: #ff6b6b; margin-bottom: 2rem;">Welcome back, <span id="dashboardUserName">User</span>!</h1>
            
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3>Your Progress</h3>
                    <div class="stat-value">7</div>
                    <div class="stat-label">Day Streak</div>
                    <div style="margin-top: 1rem;">
                        <div class="stat-value" style="font-size: 1.5rem;">45</div>
                        <div class="stat-label">Minutes This Week</div>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <h3>Quick Start</h3>
                    <div class="quick-actions">
                        <button class="btn btn-primary" onclick="startConversation('conversation')">
                            💬 Start Conversation
                        </button>
                        <button class="btn btn-secondary" onclick="startConversation('learning')">
                            📝 Learning Mode
                        </button>
                        <button class="btn btn-ghost" onclick="showScreen('practiceTopicsScreen')">
                            📚 Practice Topics
                        </button>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <h3>Recent Sessions</h3>
                    <div id="recentSessions">
                        <p style="color: #888;">No recent sessions</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Conversation Screen -->
        <div class="screen" id="conversationScreen">
            <div class="conversation-container">
                <div class="conversation-header">
                    <div>
                        <span id="conversationMode" style="background: #ff6b6b; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.875rem;">
                            Conversation Mode
                        </span>
                    </div>
                    <div class="timer" id="timer">00:00</div>
                    <button class="btn btn-ghost" onclick="endConversation()">End Session</button>
                </div>
                
                <div class="messages-container" id="messagesContainer">
                    <div class="message assistant">
                        <div class="message-role">TalkTime</div>
                        <div class="message-bubble">
                            Hello! I'm TalkTime, your English conversation partner. What would you like to talk about today?
                        </div>
                    </div>
                </div>
                
                <div class="conversation-controls">
                    <div class="mode-toggle">
                        <div class="mode-toggle-container">
                            <button class="active" onclick="switchMode('conversation')">Conversation</button>
                            <button onclick="switchMode('learning')">Learning Mode</button>
                        </div>
                    </div>
                    
                    <div class="input-controls">
                        <input 
                            type="text" 
                            id="messageInput" 
                            placeholder="Type a message or press the microphone..."
                            onkeypress="if(event.key === 'Enter') sendMessage()"
                        >
                        <button class="mic-button" id="micButton" onclick="toggleRecording()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                <line x1="12" y1="19" x2="12" y2="23"></line>
                                <line x1="8" y1="23" x2="16" y2="23"></line>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="speaking-time">
                        <div class="time-stat">
                            <div class="label">You</div>
                            <div class="value" id="userSpeakingTime">0:00</div>
                        </div>
                        <div class="time-stat">
                            <div class="label">Speaking Balance</div>
                            <div class="value" id="speakingBalance">50%</div>
                        </div>
                        <div class="time-stat">
                            <div class="label">AI</div>
                            <div class="value" id="aiSpeakingTime">0:00</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Practice Topics Screen -->
        <div class="screen" id="practiceTopicsScreen">
            <h1 style="color: #ff6b6b; margin-bottom: 2rem;">Practice Topics</h1>
            <div class="dashboard-grid">
                <div class="dashboard-card" onclick="startTopicConversation('daily')">
                    <h3>🌅 Daily Routine</h3>
                    <p>Talk about your day, habits, and activities</p>
                </div>
                <div class="dashboard-card" onclick="startTopicConversation('hobbies')">
                    <h3>🎨 Hobbies & Interests</h3>
                    <p>Discuss what you love to do in your free time</p>
                </div>
                <div class="dashboard-card" onclick="startTopicConversation('food')">
                    <h3>🍕 Food & Cooking</h3>
                    <p>Share your favorite dishes and recipes</p>
                </div>
                <div class="dashboard-card" onclick="startTopicConversation('travel')">
                    <h3>✈️ Travel & Places</h3>
                    <p>Explore destinations and travel experiences</p>
                </div>
                <div class="dashboard-card" onclick="startTopicConversation('technology')">
                    <h3>💻 Technology</h3>
                    <p>Discuss gadgets, apps, and digital life</p>
                </div>
                <div class="dashboard-card" onclick="startTopicConversation('culture')">
                    <h3>🌍 Culture & Society</h3>
                    <p>Share perspectives on culture and current events</p>
                </div>
            </div>
            <button class="btn btn-ghost" style="margin-top: 2rem;" onclick="showScreen('dashboardScreen')">Back to Dashboard</button>
        </div>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h2 style="color: #ff6b6b;">Settings</h2>
            <button class="btn btn-ghost" onclick="closeSettings()">✕</button>
        </div>
        
        <div class="settings-content">
            <div class="settings-section">
                <h3>API Configuration Status</h3>
                <div id="apiStatus">
                    <p style="color: #888;">Checking API status...</p>
                </div>
            </div>
            
            <div class="settings-section">
                <h3>Voice Recognition Provider</h3>
                <div class="provider-options" id="sttProviders">
                    <div class="provider-option" onclick="selectProvider('stt', 'browser')">
                        <div>
                            <h4>Browser (Free)</h4>
                            <p style="font-size: 0.875rem; color: #888;">Works offline</p>
                        </div>
                        <span class="status-badge available">Available</span>
                    </div>
                    <div class="provider-option disabled">
                        <div>
                            <h4>OpenAI Whisper</h4>
                            <p style="font-size: 0.875rem; color: #888;">High accuracy</p>
                        </div>
                        <span class="status-badge unavailable">API Key Required</span>
                    </div>
                    <div class="provider-option disabled">
                        <div>
                            <h4>Google Speech</h4>
                            <p style="font-size: 0.875rem; color: #888;">Premium quality</p>
                        </div>
                        <span class="status-badge unavailable">API Key Required</span>
                    </div>
                </div>
            </div>
            
            <div class="settings-section">
                <h3>Voice Synthesis Provider</h3>
                <div class="provider-options" id="ttsProviders">
                    <div class="provider-option" onclick="selectProvider('tts', 'browser')">
                        <div>
                            <h4>Browser (Free)</h4>
                            <p style="font-size: 0.875rem; color: #888;">Basic quality</p>
                        </div>
                        <span class="status-badge available">Available</span>
                    </div>
                    <div class="provider-option disabled">
                        <div>
                            <h4>OpenAI TTS</h4>
                            <p style="font-size: 0.875rem; color: #888;">Natural voices</p>
                        </div>
                        <span class="status-badge unavailable">API Key Required</span>
                    </div>
                    <div class="provider-option disabled">
                        <div>
                            <h4>ElevenLabs</h4>
                            <p style="font-size: 0.875rem; color: #888;">Most realistic</p>
                        </div>
                        <span class="status-badge unavailable">API Key Required</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Global State
        let currentUser = null;
        let currentScreen = 'welcomeScreen';
        let conversationMode = 'conversation';
        let isRecording = false;
        let recognition = null;
        let conversationTimer = null;
        let conversationStartTime = null;
        let userSpeakingTime = 0;
        let aiSpeakingTime = 0;
        let selectedGoals = [];
        let selectedLevel = '';
        let onboardingStep = 1;
        let apiProviders = {
            stt: 'browser',
            tts: 'browser'
        };

        // Initialize
        window.onload = function() {
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hidden');
                checkAuthStatus();
                initializeSpeechRecognition();
            }, 1500);
        };

        // Screen Navigation
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            currentScreen = screenId;
            
            // Show/hide header based on screen
            const header = document.getElementById('header');
            if (['dashboardScreen', 'conversationScreen', 'practiceTopicsScreen'].includes(screenId)) {
                header.style.display = 'block';
            } else {
                header.style.display = 'none';
            }
        }

        // Auth Functions
        function checkAuthStatus() {
            const savedUser = localStorage.getItem('justspeak_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                document.getElementById('userName').textContent = currentUser.name || currentUser.email;
                showScreen('dashboardScreen');
                updateDashboard();
            } else {
                showScreen('welcomeScreen');
            }
        }

        function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Simulate login
            showToast('Logging in...', 'info');
            
            setTimeout(() => {
                currentUser = {
                    email: email,
                    name: email.split('@')[0],
                    id: Date.now()
                };
                localStorage.setItem('justspeak_user', JSON.stringify(currentUser));
                document.getElementById('userName').textContent = currentUser.name;
                showToast('Welcome back!', 'success');
                showScreen('dashboardScreen');
                updateDashboard();
            }, 1000);
        }

        function handleSignup(event) {
            event.preventDefault();
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const ageGroup = document.getElementById('signupAgeGroup').value;
            
            showToast('Creating account...', 'info');
            
            setTimeout(() => {
                currentUser = {
                    name: name,
                    email: email,
                    ageGroup: ageGroup,
                    id: Date.now()
                };
                localStorage.setItem('justspeak_user', JSON.stringify(currentUser));
                document.getElementById('userName').textContent = currentUser.name;
                showToast('Account created successfully!', 'success');
                showScreen('onboardingScreen');
            }, 1000);
        }

        function startGuestMode() {
            currentUser = {
                name: 'Guest',
                email: 'guest@example.com',
                id: 'guest_' + Date.now()
            };
            document.getElementById('userName').textContent = 'Guest';
            showToast('Starting guest mode...', 'info');
            showScreen('dashboardScreen');
            updateDashboard();
        }

        function logout() {
            localStorage.removeItem('justspeak_user');
            currentUser = null;
            showToast('Logged out successfully', 'success');
            showScreen('welcomeScreen');
        }

        // Onboarding Functions
        function toggleGoal(goal) {
            const index = selectedGoals.indexOf(goal);
            if (index > -1) {
                selectedGoals.splice(index, 1);
            } else {
                selectedGoals.push(goal);
            }
            
            // Update UI
            document.querySelectorAll('#step1 .option-card').forEach((card, i) => {
                const goals = ['conversation', 'business', 'travel', 'academic'];
                if (selectedGoals.includes(goals[i])) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
        }

        function selectLevel(level) {
            selectedLevel = level;
            document.querySelectorAll('#step2 .option-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.option-card').classList.add('selected');
        }

        function nextOnboardingStep() {
            if (onboardingStep < 3) {
                document.getElementById(`step${onboardingStep}`).classList.remove('active');
                onboardingStep++;
                document.getElementById(`step${onboardingStep}`).classList.add('active');
                document.getElementById('progressBar').style.width = `${(onboardingStep / 3) * 100}%`;
            }
        }

        function previousOnboardingStep() {
            if (onboardingStep > 1) {
                document.getElementById(`step${onboardingStep}`).classList.remove('active');
                onboardingStep--;
                document.getElementById(`step${onboardingStep}`).classList.add('active');
                document.getElementById('progressBar').style.width = `${(onboardingStep / 3) * 100}%`;
            }
        }

        function completeOnboarding() {
            const dailyGoal = document.getElementById('dailyGoal').value;
            
            // Save preferences
            const preferences = {
                goals: selectedGoals,
                level: selectedLevel,
                dailyGoal: dailyGoal
            };
            
            localStorage.setItem('justspeak_preferences', JSON.stringify(preferences));
            showToast('Profile setup complete!', 'success');
            showScreen('dashboardScreen');
            updateDashboard();
        }

        // Dashboard Functions
        function updateDashboard() {
            if (currentUser) {
                document.getElementById('dashboardUserName').textContent = currentUser.name;
                
                // Update recent sessions
                const sessions = JSON.parse(localStorage.getItem('justspeak_sessions') || '[]');
                const recentSessionsDiv = document.getElementById('recentSessions');
                
                if (sessions.length > 0) {
                    recentSessionsDiv.innerHTML = sessions.slice(-3).reverse().map(session => `
                        <div style="padding: 0.5rem 0; border-bottom: 1px solid #333;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>${session.mode === 'learning' ? '📝' : '💬'} ${session.mode}</span>
                                <span style="color: #888;">${formatTime(session.duration)}</span>
                            </div>
                            <div style="font-size: 0.875rem; color: #888;">
                                ${new Date(session.date).toLocaleDateString()}
                            </div>
                        </div>
                    `).join('');
                }
            }
        }

        // Conversation Functions
        function startConversation(mode) {
            conversationMode = mode;
            document.getElementById('conversationMode').textContent = 
                mode === 'learning' ? 'Learning Mode' : 'Conversation Mode';
            
            // Reset conversation
            document.getElementById('messagesContainer').innerHTML = `
                <div class="message assistant">
                    <div class="message-role">TalkTime</div>
                    <div class="message-bubble">
                        ${mode === 'learning' 
                            ? "Hello! I'm in learning mode. I'll help correct your grammar and pronunciation as we chat. What would you like to talk about?"
                            : "Hello! I'm TalkTime, your English conversation partner. What would you like to talk about today?"}
                    </div>
                </div>
            `;
            
            // Start timer
            conversationStartTime = Date.now();
            userSpeakingTime = 0;
            aiSpeakingTime = 0;
            updateTimer();
            conversationTimer = setInterval(updateTimer, 1000);
            
            showScreen('conversationScreen');
        }

        function startTopicConversation(topic) {
            const topicStarters = {
                daily: "Let's talk about daily routines! What does a typical day look like for you?",
                hobbies: "I'd love to hear about your hobbies! What do you enjoy doing in your free time?",
                food: "Food is such a great topic! What's your favorite dish to cook or eat?",
                travel: "Travel is exciting! Where's the most interesting place you've been or would like to visit?",
                technology: "Technology is everywhere these days! What tech do you use most in your daily life?",
                culture: "Culture shapes our world! What cultural traditions or events are important to you?"
            };
            
            conversationMode = 'conversation';
            document.getElementById('messagesContainer').innerHTML = `
                <div class="message assistant">
                    <div class="message-role">TalkTime</div>
                    <div class="message-bubble">${topicStarters[topic]}</div>
                </div>
            `;
            
            conversationStartTime = Date.now();
            userSpeakingTime = 0;
            aiSpeakingTime = 0;
            updateTimer();
            conversationTimer = setInterval(updateTimer, 1000);
            
            showScreen('conversationScreen');
        }

        function endConversation() {
            clearInterval(conversationTimer);
            const duration = Math.floor((Date.now() - conversationStartTime) / 1000);
            
            // Save session
            const sessions = JSON.parse(localStorage.getItem('justspeak_sessions') || '[]');
            sessions.push({
                mode: conversationMode,
                duration: duration,
                date: new Date().toISOString(),
                userTime: userSpeakingTime,
                aiTime: aiSpeakingTime
            });
            localStorage.setItem('justspeak_sessions', JSON.stringify(sessions));
            
            showToast(`Session completed! Duration: ${formatTime(duration)}`, 'success');
            showScreen('dashboardScreen');
            updateDashboard();
        }

        function switchMode(mode) {
            conversationMode = mode;
            document.getElementById('conversationMode').textContent = 
                mode === 'learning' ? 'Learning Mode' : 'Conversation Mode';
            
            // Update toggle buttons
            document.querySelectorAll('.mode-toggle button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            addMessage('assistant', mode === 'learning' 
                ? "I've switched to learning mode. I'll help correct your grammar and provide feedback as we chat."
                : "I've switched to conversation mode. Let's have a natural conversation!");
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessage('user', message);
            input.value = '';
            
            // Simulate AI thinking
            showTypingIndicator();
            
            // Simulate API call
            setTimeout(() => {
                hideTypingIndicator();
                
                // Generate response based on mode
                let response;
                if (conversationMode === 'learning') {
                    response = generateLearningResponse(message);
                } else {
                    response = generateConversationResponse(message);
                }
                
                addMessage('assistant', response);
                
                // Speak the response
                speakText(response);
            }, 1000 + Math.random() * 1000);
        }

        function addMessage(role, content) {
            const messagesContainer = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            messageDiv.innerHTML = `
                <div class="message-role">${role === 'user' ? 'You' : 'TalkTime'}</div>
                <div class="message-bubble">${content}</div>
            `;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function generateConversationResponse(message) {
            const responses = [
                "That's interesting! Can you tell me more about that?",
                "I understand. How does that make you feel?",
                "Wow, I hadn't thought about it that way. What led you to that conclusion?",
                "That sounds fascinating! Have you always been interested in that?",
                "I see what you mean. Could you give me an example?",
                "That's a great point! What do you think about...",
                "Interesting perspective! In my experience...",
                "I appreciate you sharing that. What happened next?"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateLearningResponse(message) {
            // Simulate grammar correction
            const hasError = Math.random() > 0.5;
            
            if (hasError) {
                return `Good try! I noticed a small grammar point. Instead of "${message}", you might say "${message.replace(/dont/g, "don't")}". The meaning is clear though! What else would you like to share?`;
            } else {
                return "Excellent! Your grammar is perfect in that sentence. You're making great progress! Let's continue our conversation.";
            }
        }

        function showTypingIndicator() {
            const messagesContainer = document.getElementById('messagesContainer');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.className = 'message assistant';
            typingDiv.innerHTML = `
                <div class="message-role">TalkTime</div>
                <div class="message-bubble">
                    <div class="typing-indicator">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // Voice Functions
        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'en-US';
                
                recognition.onstart = function() {
                    console.log('Speech recognition started');
                };
                
                recognition.onresult = function(event) {
                    let finalTranscript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        if (event.results[i].isFinal) {
                            finalTranscript += event.results[i][0].transcript;
                        }
                    }
                    
                    if (finalTranscript) {
                        document.getElementById('messageInput').value = finalTranscript;
                    }
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    showToast('Speech recognition error: ' + event.error, 'error');
                    stopRecording();
                };
            } else {
                console.log('Speech recognition not supported');
            }
        }

        function toggleRecording() {
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        }

        function startRecording() {
            if (!recognition) {
                showToast('Speech recognition not available', 'error');
                return;
            }
            
            isRecording = true;
            document.getElementById('micButton').classList.add('recording');
            recognition.start();
            
            // Track user speaking time
            const startTime = Date.now();
            const interval = setInterval(() => {
                if (isRecording) {
                    userSpeakingTime = Math.floor((Date.now() - startTime) / 1000);
                    updateSpeakingTime();
                } else {
                    clearInterval(interval);
                }
            }, 100);
        }

        function stopRecording() {
            if (recognition && isRecording) {
                isRecording = false;
                document.getElementById('micButton').classList.remove('recording');
                recognition.stop();
                
                // Send the message if there's text
                const input = document.getElementById('messageInput');
                if (input.value.trim()) {
                    sendMessage();
                }
            }
        }

        function speakText(text) {
            if ('speechSynthesis' in window) {
                // Cancel any ongoing speech
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 1.0;
                utterance.pitch = 1.0;
                
                const startTime = Date.now();
                utterance.onend = () => {
                    aiSpeakingTime += Math.floor((Date.now() - startTime) / 1000);
                    updateSpeakingTime();
                };
                
                window.speechSynthesis.speak(utterance);
            }
        }

        // Timer and Stats
        function updateTimer() {
            if (conversationStartTime) {
                const elapsed = Math.floor((Date.now() - conversationStartTime) / 1000);
                document.getElementById('timer').textContent = formatTime(elapsed);
            }
        }

        function updateSpeakingTime() {
            document.getElementById('userSpeakingTime').textContent = formatTime(userSpeakingTime);
            document.getElementById('aiSpeakingTime').textContent = formatTime(aiSpeakingTime);
            
            const total = userSpeakingTime + aiSpeakingTime;
            const balance = total > 0 ? Math.round((userSpeakingTime / total) * 100) : 50;
            document.getElementById('speakingBalance').textContent = balance + '%';
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Settings Functions
        function showSettings() {
            document.getElementById('settingsPanel').classList.add('open');
            checkAPIStatus();
        }

        function closeSettings() {
            document.getElementById('settingsPanel').classList.remove('open');
        }

        function checkAPIStatus() {
            // Simulate API status check
            const apiStatusDiv = document.getElementById('apiStatus');
            apiStatusDiv.innerHTML = `
                <div style="padding: 0.5rem 0;">
                    <div style="display: flex; justify-content: space-between;">
                        <span>OpenAI API</span>
                        <span style="color: #f44336;">Not Configured</span>
                    </div>
                </div>
                <div style="padding: 0.5rem 0;">
                    <div style="display: flex; justify-content: space-between;">
                        <span>ElevenLabs API</span>
                        <span style="color: #f44336;">Not Configured</span>
                    </div>
                </div>
                <div style="padding: 0.5rem 0;">
                    <div style="display: flex; justify-content: space-between;">
                        <span>Google Speech API</span>
                        <span style="color: #f44336;">Not Configured</span>
                    </div>
                </div>
                <p style="margin-top: 1rem; font-size: 0.875rem; color: #888;">
                    Note: API keys should be configured in the server environment.
                </p>
            `;
        }

        function selectProvider(type, provider) {
            apiProviders[type] = provider;
            
            // Update UI
            const selector = type === 'stt' ? '#sttProviders' : '#ttsProviders';
            document.querySelectorAll(`${selector} .provider-option`).forEach(option => {
                option.classList.remove('selected');
            });
            event.target.closest('.provider-option').classList.add('selected');
            
            showToast(`${type.toUpperCase()} provider changed to ${provider}`, 'success');
        }

        // Toast Notifications
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span>${message}</span>
                <button onclick="this.parentElement.remove()" style="background: none; border: none; color: white; cursor: pointer;">✕</button>
            `;
            
            document.getElementById('toastContainer').appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        // Keyboard Shortcuts
        document.addEventListener('keydown', (e) => {
            if (currentScreen === 'conversationScreen') {
                if (e.key === ' ' && e.ctrlKey) {
                    e.preventDefault();
                    toggleRecording();
                }
            }
        });
    </script>
</body>
</html>