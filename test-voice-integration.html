<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TalkTime - Voice Integration Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #1a1a1a;
            color: white;
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            color: #ff8e58;
        }

        .info-box {
            background: #2d2d2d;
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1rem 0;
            border-left: 4px solid #ff8e58;
        }

        .test-section {
            background: #2d2d2d;
            padding: 2rem;
            border-radius: 12px;
            margin: 2rem 0;
        }

        button {
            background: #ff8e58;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem;
        }

        button:hover {
            background: #ff6e32;
        }

        button:disabled {
            background: #666;
            cursor: not-allowed;
        }

        #status {
            margin: 1rem 0;
            padding: 1rem;
            background: #1a1a1a;
            border-radius: 8px;
            font-family: monospace;
        }

        .error {
            color: #f44336;
        }

        .success {
            color: #4CAF50;
        }

        #transcript {
            background: #1a1a1a;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            min-height: 100px;
        }

        code {
            background: #1a1a1a;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <h1>TalkTime Voice Integration Test</h1>

    <div class="info-box">
        <h2>⚠️ Important Note</h2>
        <p>This is a standalone test page for the Web Speech API. For the full TalkTime experience with all features integrated, you need to run the Next.js application:</p>
        <ol>
            <li>Open terminal in the project directory</li>
            <li>Run: <code>npm install</code> (if not done already)</li>
            <li>Run: <code>npm run dev</code></li>
            <li>Open: <code>http://localhost:3000</code></li>
        </ol>
    </div>

    <div class="test-section">
        <h2>Browser Voice API Test</h2>
        <p>This tests your browser's native speech recognition capabilities:</p>
        
        <div>
            <button id="startBtn" onclick="startRecognition()">Start Microphone</button>
            <button id="stopBtn" onclick="stopRecognition()" disabled>Stop Microphone</button>
            <button onclick="testSpeechSynthesis()">Test Voice Output</button>
        </div>

        <div id="status">
            Status: <span id="statusText">Ready</span>
        </div>

        <div>
            <h3>Transcript:</h3>
            <div id="transcript">Speak after clicking "Start Microphone"...</div>
        </div>

        <div>
            <h3>Browser Compatibility:</h3>
            <ul id="compatibility"></ul>
        </div>
    </div>

    <div class="test-section">
        <h2>Troubleshooting</h2>
        <h3>If microphone doesn't work:</h3>
        <ol>
            <li><strong>Check browser permissions:</strong> Allow microphone access when prompted</li>
            <li><strong>Use HTTPS:</strong> Web Speech API requires HTTPS (localhost is okay)</li>
            <li><strong>Browser support:</strong> Use Chrome, Edge, or Safari (Firefox has limited support)</li>
            <li><strong>Check microphone:</strong> Ensure your microphone is connected and working</li>
        </ol>

        <h3>Common Issues:</h3>
        <ul>
            <li><strong>No speech detected:</strong> Speak clearly and check your microphone volume</li>
            <li><strong>Recognition stops quickly:</strong> The API stops after silence, click start again</li>
            <li><strong>Wrong language:</strong> The app is set to English (en-US)</li>
        </ul>
    </div>

    <script>
        let recognition = null;
        let isListening = false;

        // Check browser compatibility
        function checkCompatibility() {
            const compatList = document.getElementById('compatibility');
            const checks = [
                {
                    name: 'Web Speech API (Recognition)',
                    supported: 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window
                },
                {
                    name: 'Speech Synthesis',
                    supported: 'speechSynthesis' in window
                },
                {
                    name: 'Microphone API',
                    supported: 'mediaDevices' in navigator && 'getUserMedia' in navigator.mediaDevices
                },
                {
                    name: 'HTTPS or Localhost',
                    supported: location.protocol === 'https:' || location.hostname === 'localhost'
                }
            ];

            checks.forEach(check => {
                const li = document.createElement('li');
                li.innerHTML = `${check.name}: <span class="${check.supported ? 'success' : 'error'}">${check.supported ? '✓ Supported' : '✗ Not Supported'}</span>`;
                compatList.appendChild(li);
            });
        }

        // Initialize speech recognition
        function initRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            if (!SpeechRecognition) {
                updateStatus('Speech recognition not supported in this browser', 'error');
                return false;
            }

            recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onstart = () => {
                isListening = true;
                updateStatus('Listening... Speak now!', 'success');
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
            };

            recognition.onresult = (event) => {
                let finalTranscript = '';
                let interimTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript + ' ';
                    } else {
                        interimTranscript += transcript;
                    }
                }

                const transcriptDiv = document.getElementById('transcript');
                transcriptDiv.innerHTML = `
                    <strong>Final:</strong> ${finalTranscript}<br>
                    <em>Interim:</em> ${interimTranscript}
                `;
            };

            recognition.onerror = (event) => {
                updateStatus(`Error: ${event.error}`, 'error');
                console.error('Speech recognition error:', event);
                stopRecognition();
            };

            recognition.onend = () => {
                isListening = false;
                updateStatus('Stopped listening', '');
                document.getElementById('startBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
            };

            return true;
        }

        function startRecognition() {
            if (!recognition && !initRecognition()) {
                return;
            }

            // Request microphone permission first
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    // Stop the stream immediately - we just needed permission
                    stream.getTracks().forEach(track => track.stop());
                    
                    // Start recognition
                    try {
                        recognition.start();
                    } catch (e) {
                        updateStatus('Failed to start recognition: ' + e.message, 'error');
                    }
                })
                .catch(err => {
                    updateStatus('Microphone access denied: ' + err.message, 'error');
                });
        }

        function stopRecognition() {
            if (recognition && isListening) {
                recognition.stop();
            }
        }

        function testSpeechSynthesis() {
            if (!('speechSynthesis' in window)) {
                updateStatus('Speech synthesis not supported', 'error');
                return;
            }

            const utterance = new SpeechSynthesisUtterance('Hello! This is TalkTime testing voice synthesis. Can you hear me?');
            utterance.lang = 'en-US';
            utterance.rate = 1;
            utterance.pitch = 1;

            updateStatus('Speaking...', 'success');
            speechSynthesis.speak(utterance);

            utterance.onend = () => {
                updateStatus('Speech synthesis complete', 'success');
            };
        }

        function updateStatus(message, className) {
            const statusText = document.getElementById('statusText');
            statusText.textContent = message;
            statusText.className = className;
        }

        // Check compatibility on load
        window.addEventListener('load', () => {
            checkCompatibility();
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (recognition && isListening) {
                recognition.stop();
            }
        });
    </script>
</body>
</html>